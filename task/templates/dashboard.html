{% extends "base.html" %}
{% load staticfiles %}
{% block title %}Test{% endblock %}
{% block content %}
    <div class="row">
        <div class="panel panel-headline">
            <div class="panel-heading">
                <h3 class="panel-title">Data Overview</h3>
                <!--p class="panel-subtitle">Demo</p-->
            </div>
            <div class="panel-body">
                <div class="col-md-8">
                    <div id="vmap" style="width: 600px; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <ul class="list-unstyled task-list">
                        <li>
                            <p>US <span class="label-percent">133</span></p>
                            <div class="progress progress-xs">
                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="23" aria-valuemin="0" aria-valuemax="100" style="width:33%">
                                    <span class="sr-only">33% Complete</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <p>GE<span class="label-percent">100</span></p>
                            <div class="progress progress-xs">
                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 10%">
                                    <span class="sr-only">30% Complete</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <p>JP <span class="label-percent">135</span></p>
                            <div class="progress progress-xs">
                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 35%">
                                    <span class="sr-only">Success</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <p>UK <span class="label-percent">122</span></p>
                            <div class="progress progress-xs">
                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 22%">
                                    <span class="sr-only">45% Complete</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            {#        <script src="{% static 'assets/vmap/' %}js/jquery.vmap.sampledata.js"></script>#}

            <script type="text/javascript">
                jQuery(document).ready(function () {
                    jQuery('#vmap').vectorMap({
                        map: 'world_en',
                        backgroundColor: '#fff',
                        color: '#ffffff',
                        hoverOpacity: 0.7,
                        selectedColor: '#666666',
                        enableZoom: true,
                        showTooltip: true,
                        values: {
                            "gb": "50.0",
                            "de": "50",
                            "jp": "50",
                            "us": "50",
                            "ye": 0,
                            "dz": 0,
                            "uy": 0,
                            "vu": 0,
                            "qa": 0,
                            "zm": 0,
                            "ee": 0,
                            "eg": 0,
                            "za": 0,
                            "ec": 0,
                            "et": 0,
                            "zw": 0,
                            "es": 0,
                            "er": 0,
                            "ru": 0,
                            "rw": 0,
                            "rs": 0,
                            "ro": 0,
                            "bd": 0,
                            "be": 0,
                            "bf": 0,
                            "bg": 0,
                            "ba": 0,
                            "bb": 0,
                            "bh": 0,
                            "bn": 0,
                            "bo": 0,
                            "bi": 0,
                            "bj": 0,
                            "bt": 0,
                            "jm": 0,
                            "jo": 0,
                            "ws": 0,
                            "br": 0,
                            "bs": 0,
                            "lb": 0,
                            "by": 0,
                            "bz": 0,
                            "om": 0,
                            "ua": 0,
                            "lr": 0,
                            "bw": 0,
                            "ci": 0,
                            "ch": 0,
                            "co": 0,
                            "cn": 0,
                            "cm": 0,
                            "cl": 0,
                            "al": 0,
                            "ca": 0,
                            "cg": 0,
                            "cf": 0,
                            "cd": 0,
                            "cz": 0,
                            "cy": 0,
                            "cr": 0,
                            "cv": 0,
                            "lv": 0,
                            "pt": 0,
                            "py": 0,
                            "lt": 0,
                            "at": 0,
                            "pa": 0,
                            "pg": 0,
                            "pe": 0,
                            "pk": 0,
                            "ph": 0,
                            "pl": 0,
                            "hr": 0,
                            "ht": 0,
                            "hu": 0,
                            "hk": 0,
                            "lu": 0,
                            "hn": 0,
                            "ao": 0,
                            "me": 0,
                            "md": 0,
                            "mg": 0,
                            "ma": 0,
                            "uz": 0,
                            "mm": 0,
                            "ml": 0,
                            "mn": 0,
                            "mk": 0,
                            "mu": 0,
                            "mt": 0,
                            "mw": 0,
                            "mv": 0,
                            "mr": 0,
                            "ug": 0,
                            "my": 0,
                            "mx": 0,
                            "mz": 0,
                            "vc": 0,
                            "ae": 0,
                            "ve": 0,
                            "ag": 0,
                            "af": 0,
                            "iq": 0,
                            "is": 0,
                            "ir": 0,
                            "am": 0,
                            "it": 0,
                            "vn": 0,
                            "kn": 0,
                            "ar": 0,
                            "au": 0,
                            "il": 0,
                            "in": 0,
                            "az": 0,
                            "ie": 0,
                            "id": 0,
                            "ni": 0,
                            "nl": 0,
                            "no": 0,
                            "na": 0,
                            "ne": 0,
                            "ng": 0,
                            "nz": 0,
                            "np": 0,
                            "fr": 0,
                            "kz": 0,
                            "fi": 0,
                            "fj": 0,
                            "sz": 0,
                            "sy": 0,
                            "kg": 0,
                            "ke": 0,
                            "sr": 0,
                            "ki": 0,
                            "kh": 0,
                            "sv": 0,
                            "km": 0,
                            "st": 0,
                            "sk": 0,
                            "kr": 0,
                            "si": 0,
                            "kw": 0,
                            "sn": 0,
                            "sl": 0,
                            "sc": 0,
                            "sb": 0,
                            "sa": 0,
                            "sg": 0,
                            "se": 0,
                            "sd": 0,
                            "undefined": "5.73",
                        },
                        scaleColors: ['#C8EEFF', '#006491'],
                        normalizeFunction: 'polynomial'
                    });
                });
            </script>

        </div>
    </div>
    <div class="row">
        {#        <div class="col-md-12">#}
        <div class="col-md-8">
            <div class="panel">
                <div class=" panel-headline">
                    <div class="panel-heading">
                        <h3 class="panel-title">Performance overview</h3>
                        <!--p class="panel-subtitle">Demo</p-->
                    </div>
                </div>
                <div class="panel-body">
                    <div class="row center-block">
                        <div>{{ myechart|safe }}</div>
                    </div>
                </div>
            </div>
            {#        </div>#}
        </div>
        <div class="col-md-4">
            <div class="panel panel-headline">
                <div class="panel-heading">
                    {#                    <h3 class="panel-title">Overview</h3>#}
                    <!--p class="panel-subtitle">Demo</p-->
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="metric">
                            <span class="icon"><i class="fa fa-line-chart icon"></i></span>
                            <p>
                                <span class="number">{{ run_rtv_numbers }}</span>
                                <span class="title">Rtv tested</span>
                            </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="metric">
                            <span class="icon"><i class="fa fa-clock-o icon"></i></span>
                            <p>
                                <span class="number">{{ time_cost }}</span>
                                <span class="title">Time cost</span>
                            </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="metric">
                            <span class="icon"><i class="fa fa-database icon"></i></span>
                            <p>
                                <span class="number">602</span>
                                <span class="title">Rtv we have</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="panel panel-headline">
            <div class="panel-heading">
                <h3 class="panel-title">Overview</h3>
                <!--p class="panel-subtitle">Demo</p-->
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="metric">
                            <span class="icon"><i class="fa fa-line-chart icon"></i></span>
                            <p>
                                <span class="number">{{ run_rtv_numbers }}</span>
                                <span class="title">Rtv tested</span>
                            </p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric">
                            <span class="icon"><i class="fa fa-clock-o icon"></i></span>
                            <p>
                                <span class="number">{{ time_cost }}</span>
                                <span class="title">Time cost</span>
                            </p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric">
                            <span class="icon"><i class="fa fa-database icon"></i></span>
                            <p>
                                <span class="number">602</span>
                                <span class="title">Rtv we have</span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-9">{{ charts }}</div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="panel">
                <div class="panel-heading">
                    <h3 class="panel-title">Recent Tasks</h3>
                    <div class="right">
                        <button type="button" class="btn-toggle-collapse"><i class="lnr lnr-chevron-up"></i></button>
                        <!--button type="button" class="btn-remove"><i class="lnr lnr-cross"></i></button-->
                    </div>
                </div>
                <div class="panel-body no-padding">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Task ID.</th>
                            <th>Name</th>
                            <th>Mode</th>
                            <th>Area</th>
                            <th>Date &amp; Time</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for task in tasks %}
                            <tr>
                                <td><a href="/test/{{ task.id }}">{{ task.id }}</a></td>
                                <td>{{ task.tester }}</td>
                                <td>{{ task.mode }}</td>
                                <td>{{ task.area }}</td>
                                <!-- H:i:s -->
                                <td>{{ task.created|date:"Y-m-d H:i:s" }}</td>
                                <td><span id="{{ task.id }}_status" class="label label-default">loading</span></td>
                            </tr>
                            <script>
                                $(document).ready(function () {
                                    function get_status() {
                                        $.getJSON('/test/{{ task.id }}/status', function (ret) {
                                            if (ret.status == 'SLAM') {
                                                $('#{{ task.id }}_status').html("SLAM");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-primary animated flash slower infinite");
                                            } else if (ret.status == 'SSA') {
                                                $('#{{ task.id }}_status').html("SSA");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-primary animated flash slower infinite");
                                            } else if (ret.status == 'backup') {
                                                $('#{{ task.id }}_status').html("Backup");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-primary animated flash slower infinite");
                                            } else if (ret.status == 'Waiting') {
                                                $('#{{ task.id }}_status').html("Waiting");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-warning");
                                            } else if (ret.status == 'build') {
                                                $('#{{ task.id }}_status').html("building");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-primary animated flash slower infinite");
                                            } else if (ret.status == 'SLAMdone') {
                                                $('#{{ task.id }}_status').html("Done");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-success");
                                            } else if (ret.status == 'backupdone') {
                                                $('#{{ task.id }}_status').html("Done");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-success");
                                            } else if (ret.status == 'buildfailed') {
                                                $('#{{ task.id }}_status').html("Failed");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-danger");
                                            } else if (ret.status == 'SLAMfailed') {
                                                $('#{{ task.id }}_status').html("Failed");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-danger");
                                            } else if (ret.status == 'SSAfailed') {
                                                $('#{{ task.id }}_status').html("Failed");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-danger");
                                            } else {
                                                $('#{{ task.id }}_status').html("error");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-danger");
                                            }

                                        })
                                    }

                                    {#setInterval(get_status, 1000);#}
                                    var interval = setInterval(function () {
                                        $.getJSON('/test/{{ task.id }}/status', function (ret) {
                                            if (ret.status == 'SLAMdone' && ret.mode == 'SLAM') {
                                                clearInterval(interval);
                                            }
                                            if (ret.status == 'done' && ret.mode == 'SSA') {
                                                clearInterval(interval);
                                            }
                                        });
                                        get_status()
                                    }, 1000)
                                })
                            </script>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-6"><span class="panel-note"><i class="fa fa-clock-o"></i> Last 5 tasks</span></div>
                        <div class="col-md-6 text-right"><a href="/alltasks" class="btn btn-primary">View All Tasks</a></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel">
                <div class="panel-heading">
                    <h3 class="panel-title">Your Tasks</h3>
                    <div class="right">
                        <button type="button" class="btn-toggle-collapse"><i class="lnr lnr-chevron-up"></i></button>
                        <!--button type="button" class="btn-remove"><i class="lnr lnr-cross"></i></button-->
                    </div>
                </div>
                <div class="panel-body no-padding">
                    <table class="table ">
                        <thead>
                        <tr>
                            <th>Task ID.</th>
                            <th>Mode</th>
                            <th>Area</th>
                            <th>Date &amp; Time</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for task in my_tasks %}
                            <tr>
                                <td><a href="/test/{{ task.id }}">{{ task.id }}</a></td>
                                <td>{{ task.mode }}</td>
                                <td>{{ task.area }}</td>
                                <td>{{ task.created|date:"Y-m-d H:i:s" }}</td>
                                <td class="text-center"><span id="{{ task.id }}_mystatus" class="label label-default ">loading</span></td>
                                <script>
                                    $(document).ready(function () {
                                        function get_status() {
                                            $.getJSON('/test/{{ task.id }}/status', function (ret) {
                                                if (ret.status == 'SLAM') {
                                                    $('#{{ task.id }}_mystatus').html("SLAM");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-primary animated flash slower infinite");
                                                } else if (ret.status == 'SSA') {
                                                    $('#{{ task.id }}_mystatus').html("SSA");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-primary animated flash slower infinite");
                                                } else if (ret.status == 'backup') {
                                                    $('#{{ task.id }}_mystatus').html("Backup");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-primary animated flash slower infinite");
                                                } else if (ret.status == 'Waiting') {
                                                    $('#{{ task.id }}_mystatus').html("Waiting");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-warning");
                                                } else if (ret.status == 'build') {
                                                    $('#{{ task.id }}_mystatus').html("building");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-primary animated flash slower infinite");
                                                } else if (ret.status == 'SLAMdone') {
                                                    $('#{{ task.id }}_mystatus').html("Done");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-success");
                                                } else if (ret.status == 'backupdone') {
                                                    $('#{{ task.id }}_mystatus').html("Done");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-success");
                                                } else if (ret.status == 'buildfailed') {
                                                    $('#{{ task.id }}_mystatus').html("Failed");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-danger");
                                                } else if (ret.status == 'SLAMfailed') {
                                                    $('#{{ task.id }}_mystatus').html("Failed");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-danger");
                                                } else if (ret.status == 'SSAfailed') {
                                                    $('#{{ task.id }}_mystatus').html("Failed");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-danger");
                                                } else {
                                                    $('#{{ task.id }}_mystatus').html("error");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-danger");
                                                }
                                            })
                                        }

                                        {#setInterval(get_status, 1000);#}
                                        var interval = setInterval(function () {
                                            $.getJSON('/test/{{ task.id }}/status', function (ret) {
                                                if (ret.status == 'SLAMdone' && ret.mode == 'SLAM') {
                                                    clearInterval(interval);
                                                }
                                                if (ret.status == 'done' && ret.mode == 'SSA') {
                                                    clearInterval(interval);
                                                }
                                            });
                                            get_status()
                                        }, 1000)
                                    })
                                </script>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-6"><span class="panel-note"><i class="fa fa-clock-o"></i> Last 5 tasks of yours</span></div>
                        <div class="col-md-6 text-right"><a href="/allmytasks" class="btn btn-primary">View All Your Tasks</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
