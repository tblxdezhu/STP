{% extends "base.html" %}
{% load staticfiles %}
{% block title %}Test{% endblock %}
{% block content %}
    <div class="row">
        <div class="panel panel-headline">
            <div class="panel-heading">
                <h3 class="panel-title">Data Overview</h3>
                <div class="right">
                    <button type="button" class="btn-toggle-collapse"><i class="lnr lnr-chevron-up"></i></button>
                    <button type="button" class="btn-remove"><i class="lnr lnr-cross"></i></button>
                </div>
                <!--p class="panel-subtitle">Demo</p-->
            </div>
            <div class="panel-body">
                <div class="col-md-8">
                    <div id="vmap" style="width: auto; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <ul class="list-unstyled task-list">
                        <li>
                            <p>US <span class="label-percent">133</span></p>
                            <div class="progress progress-xs">
                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="23" aria-valuemin="0" aria-valuemax="100" style="width:33%">
                                    <span class="sr-only">33% Complete</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <p>GE<span class="label-percent">100</span></p>
                            <div class="progress progress-xs">
                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 10%">
                                    <span class="sr-only">30% Complete</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <p>JP <span class="label-percent">135</span></p>
                            <div class="progress progress-xs">
                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 35%">
                                    <span class="sr-only">Success</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <p>UK <span class="label-percent">122</span></p>
                            <div class="progress progress-xs">
                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 22%">
                                    <span class="sr-only">45% Complete</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            {#        <script src="{% static 'assets/vmap/' %}js/jquery.vmap.sampledata.js"></script>#}

            <script type="text/javascript">
                jQuery(document).ready(function () {
                    jQuery('#vmap').vectorMap({
                        map: 'world_en',
                        backgroundColor: '#fff',
                        color: '#ffffff',
                        hoverOpacity: 0.7,
                        selectedColor: '#666666',
                        enableZoom: true,
                        showTooltip: true,
                        values: {
                            "gb": "50.0",
                            "de": "50",
                            "jp": "50",
                            "us": "50",
                            "ye": 5,
                            "dz": 5,
                            "uy": 5,
                            "vu": 5,
                            "qa": 5,
                            "zm": 5,
                            "ee": 5,
                            "eg": 5,
                            "za": 5,
                            "ec": 5,
                            "et": 5,
                            "zw": 5,
                            "es": 5,
                            "er": 5,
                            "ru": 5,
                            "rw": 5,
                            "rs": 5,
                            "ro": 5,
                            "bd": 5,
                            "be": 5,
                            "bf": 5,
                            "bg": 5,
                            "ba": 5,
                            "bb": 5,
                            "bh": 5,
                            "bn": 5,
                            "bo": 5,
                            "bi": 5,
                            "bj": 5,
                            "bt": 5,
                            "jm": 5,
                            "jo": 5,
                            "ws": 5,
                            "br": 5,
                            "bs": 5,
                            "lb": 5,
                            "by": 5,
                            "bz": 5,
                            "om": 5,
                            "ua": 5,
                            "lr": 5,
                            "bw": 5,
                            "ci": 5,
                            "ch": 5,
                            "co": 5,
                            "cn": 5,
                            "cm": 5,
                            "cl": 5,
                            "al": 5,
                            "ca": 5,
                            "cg": 5,
                            "cf": 5,
                            "cd": 5,
                            "cz": 5,
                            "cy": 5,
                            "cr": 5,
                            "cv": 5,
                            "lv": 5,
                            "pt": 5,
                            "py": 5,
                            "lt": 5,
                            "at": 5,
                            "pa": 5,
                            "pg": 5,
                            "pe": 5,
                            "pk": 5,
                            "ph": 5,
                            "pl": 5,
                            "hr": 5,
                            "ht": 5,
                            "hu": 5,
                            "hk": 5,
                            "lu": 5,
                            "hn": 5,
                            "ao": 5,
                            "me": 5,
                            "md": 5,
                            "mg": 5,
                            "ma": 5,
                            "uz": 5,
                            "mm": 5,
                            "ml": 5,
                            "mn": 5,
                            "mk": 5,
                            "mu": 5,
                            "mt": 5,
                            "mw": 5,
                            "mv": 5,
                            "mr": 5,
                            "ug": 5,
                            "my": 5,
                            "mx": 5,
                            "mz": 5,
                            "vc": 5,
                            "ae": 5,
                            "ve": 5,
                            "ag": 5,
                            "af": 5,
                            "iq": 5,
                            "is": 5,
                            "ir": 5,
                            "am": 5,
                            "it": 5,
                            "vn": 5,
                            "kn": 5,
                            "ar": 5,
                            "au": 5,
                            "il": 5,
                            "in": 5,
                            "az": 5,
                            "ie": 5,
                            "id": 5,
                            "ni": 5,
                            "nl": 5,
                            "no": 5,
                            "na": 5,
                            "ne": 5,
                            "ng": 5,
                            "nz": 5,
                            "np": 5,
                            "fr": 5,
                            "kz": 5,
                            "fi": 5,
                            "fj": 5,
                            "sz": 5,
                            "sy": 5,
                            "kg": 5,
                            "ke": 5,
                            "sr": 5,
                            "ki": 5,
                            "kh": 5,
                            "sv": 5,
                            "km": 5,
                            "st": 5,
                            "sk": 5,
                            "kr": 5,
                            "si": 5,
                            "kw": 5,
                            "sn": 5,
                            "sl": 5,
                            "sc": 5,
                            "sb": 5,
                            "sa": 5,
                            "sg": 5,
                            "se": 5,
                            "sd": 5,
                            "undefined": "5.73",
                        },
                        scaleColors: ['#C8EEFF', '#006491'],
                        normalizeFunction: 'polynomial'
                    });
                });
            </script>

        </div>
    </div>
    <div class="row">
        {#        <div class="col-md-12">#}
        <div class="col-md-8">
            <div class="panel">
                <div class=" panel-headline">
                    <div class="panel-heading">
                        <h3 class="panel-title">Performance overview</h3>
                        <div class="right">
                            <button type="button" class="btn-toggle-collapse"><i class="lnr lnr-chevron-up"></i></button>
                            <button type="button" class="btn-remove"><i class="lnr lnr-cross"></i></button>
                        </div>
                        <!--p class="panel-subtitle">Demo</p-->
                    </div>
                </div>
                <div class="panel-body">
                    <div class="row center-block">
                        <div>{{ myechart|safe }}</div>
                    </div>
                </div>
            </div>
            {#        </div>#}
        </div>
        <div class="col-md-4">
            <div class="panel panel-scrolling panel-headline">
                <div class="panel-heading">
                    <h3 class="panel-title">Recent User Activity</h3>
                    <p class="panel-subtitle">Demo</p>
                    <div class="right">
                        <button type="button" class="btn-toggle-collapse"><i class="lnr lnr-chevron-up"></i></button>
                        <button type="button" class="btn-remove"><i class="lnr lnr-cross"></i></button>
                    </div>
                </div>
                <div class="panel-body">
                    <ul class="list-unstyled activity-list">
                        <li>
                            <img src="assets/img/user1.png" alt="Avatar" class="img-circle pull-left avatar">
                            <p><a href="#">Michael</a> has achieved 80% of his completed tasks <span class="timestamp">20 minutes ago</span></p>
                        </li>
                        <li>
                            <img src="assets/img/user2.png" alt="Avatar" class="img-circle pull-left avatar">
                            <p><a href="#">Daniel</a> has been added as a team member to project <a href="#">System Update</a> <span class="timestamp">Yesterday</span></p>
                        </li>
                        <li>
                            <img src="assets/img/user3.png" alt="Avatar" class="img-circle pull-left avatar">
                            <p><a href="#">Martha</a> created a new heatmap view <a href="#">Landing Page</a> <span class="timestamp">2 days ago</span></p>
                        </li>
                        <li>
                            <img src="assets/img/user4.png" alt="Avatar" class="img-circle pull-left avatar">
                            <p><a href="#">Jane</a> has completed all of the tasks <span class="timestamp">2 days ago</span></p>
                        </li>
                        <li>
                            <img src="assets/img/user5.png" alt="Avatar" class="img-circle pull-left avatar">
                            <p><a href="#">Jason</a> started a discussion about <a href="#">Weekly Meeting</a> <span class="timestamp">3 days ago</span></p>
                        </li>

                    </ul>
                    <button type="button" class="btn btn-primary btn-bottom center-block">Load More</button>

                </div>
            </div>
        </div>
    </div>

    {#    <div class="row">#}
    {#        <div class="panel panel-headline">#}
    {#            <div class="panel-heading">#}
    {#                <h3 class="panel-title">Overview</h3>#}
    {#                <!--p class="panel-subtitle">Demo</p-->#}
    {#            </div>#}
    {#            <div class="panel-body">#}
    {#                <div class="row">#}
    {#                    <div class="col-md-3">#}
    {#                        <div class="metric">#}
    {#                            <span class="icon"><i class="fa fa-line-chart icon"></i></span>#}
    {#                            <p>#}
    {#                                <span class="number">{{ run_rtv_numbers }}</span>#}
    {#                                <span class="title">Rtv tested</span>#}
    {#                            </p>#}
    {#                        </div>#}
    {#                    </div>#}
    {#                    <div class="col-md-4">#}
    {#                        <div class="metric">#}
    {#                            <span class="icon"><i class="fa fa-clock-o icon"></i></span>#}
    {#                            <p>#}
    {#                                <span class="number">{{ time_cost }}</span>#}
    {#                                <span class="title">Time cost</span>#}
    {#                            </p>#}
    {#                        </div>#}
    {#                    </div>#}
    {#                    <div class="col-md-3">#}
    {#                        <div class="metric">#}
    {#                            <span class="icon"><i class="fa fa-database icon"></i></span>#}
    {#                            <p>#}
    {#                                <span class="number">602</span>#}
    {#                                <span class="title">Rtv we have</span>#}
    {#                            </p>#}
    {#                        </div>#}
    {#                    </div>#}
    {#                </div>#}
    {#                <div class="row">#}
    {#                    <div class="col-md-9">{{ charts }}</div>#}
    {#                </div>#}
    {#            </div>#}
    {#        </div>#}
    {#    </div>#}

    <div class="row">
        <div class="col-md-7">
            <div class="panel">
                <div class="panel-heading">
                    <h3 class="panel-title">Recent Tasks</h3>
                    <div class="right">
                        <button type="button" class="btn-toggle-collapse"><i class="lnr lnr-chevron-up"></i></button>
                        <!--button type="button" class="btn-remove"><i class="lnr lnr-cross"></i></button-->
                    </div>
                </div>
                <div class="panel-body no-padding">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Task ID.</th>
                            <th>Name</th>
                            <th>Mode</th>
                            <th>Area</th>
                            <th>Date &amp; Time</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for task in tasks %}
                            <tr>
                                <td><a href="/test/{{ task.id }}">{{ task.id }}</a></td>
                                <td>{{ task.tester }}</td>
                                <td>{{ task.mode }}</td>
                                <td>{{ task.area }}</td>
                                <!-- H:i:s -->
                                <td>{{ task.created|date:"Y-m-d H:i:s" }}</td>
                                <td><span id="{{ task.id }}_status" class="label label-default">loading</span></td>
                            </tr>
                            <script>
                                $(document).ready(function () {
                                    function get_status() {
                                        $.getJSON('/test/{{ task.id }}/status', function (ret) {
                                            if (ret.status == 'SLAM') {
                                                $('#{{ task.id }}_status').html("SLAM");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-primary animated flash slower infinite");
                                            } else if (ret.status == 'SSA') {
                                                $('#{{ task.id }}_status').html("SSA");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-primary animated flash slower infinite");
                                            } else if (ret.status == 'backup') {
                                                $('#{{ task.id }}_status').html("Backup");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-primary animated flash slower infinite");
                                            } else if (ret.status == 'Waiting') {
                                                $('#{{ task.id }}_status').html("Waiting");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-warning");
                                            } else if (ret.status == 'build') {
                                                $('#{{ task.id }}_status').html("building");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-primary animated flash slower infinite");
                                            } else if (ret.status == 'SLAMdone') {
                                                $('#{{ task.id }}_status').html("Done");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-success");
                                            } else if (ret.status == 'backupdone') {
                                                $('#{{ task.id }}_status').html("Done");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-success");
                                            } else if (ret.status == 'buildfailed') {
                                                $('#{{ task.id }}_status').html("Failed");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-danger");
                                            } else if (ret.status == 'SLAMfailed') {
                                                $('#{{ task.id }}_status').html("Failed");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-danger");
                                            } else if (ret.status == 'SSAfailed') {
                                                $('#{{ task.id }}_status').html("Failed");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-danger");
                                            } else {
                                                $('#{{ task.id }}_status').html("error");
                                                $('#{{ task.id }}_status').removeClass().addClass("label label-danger");
                                            }

                                        })
                                    }

                                    {#setInterval(get_status, 1000);#}
                                    var interval = setInterval(function () {
                                        $.getJSON('/test/{{ task.id }}/status', function (ret) {
                                            if (ret.status == 'SLAMdone' && ret.mode == 'SLAM') {
                                                clearInterval(interval);
                                            }
                                            if (ret.status == 'done' && ret.mode == 'SSA') {
                                                clearInterval(interval);
                                            }
                                        });
                                        get_status()
                                    }, 1000)
                                })
                            </script>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-6"><span class="panel-note"><i class="fa fa-clock-o"></i> Last 5 tasks</span></div>
                        <div class="col-md-6 text-right"><a href="/alltasks" class="btn btn-primary">View All Tasks</a></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="panel">
                <div class="panel-heading">
                    <h3 class="panel-title">Your Tasks</h3>
                    <div class="right">
                        <button type="button" class="btn-toggle-collapse"><i class="lnr lnr-chevron-up"></i></button>
                        <!--button type="button" class="btn-remove"><i class="lnr lnr-cross"></i></button-->
                    </div>
                </div>
                <div class="panel-body no-padding">
                    <table class="table ">
                        <thead>
                        <tr>
                            <th>Task ID.</th>
                            <th>Mode</th>
                            <th>Area</th>
                            <th>Date &amp; Time</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for task in my_tasks %}
                            <tr>
                                <td><a href="/test/{{ task.id }}">{{ task.id }}</a></td>
                                <td>{{ task.mode }}</td>
                                <td>{{ task.area }}</td>
                                <td>{{ task.created|date:"Y-m-d H:i:s" }}</td>
                                <td class="text-center"><span id="{{ task.id }}_mystatus" class="label label-default ">loading</span></td>
                                <script>
                                    $(document).ready(function () {
                                        function get_status() {
                                            $.getJSON('/test/{{ task.id }}/status', function (ret) {
                                                if (ret.status == 'SLAM') {
                                                    $('#{{ task.id }}_mystatus').html("SLAM");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-primary animated flash slower infinite");
                                                } else if (ret.status == 'SSA') {
                                                    $('#{{ task.id }}_mystatus').html("SSA");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-primary animated flash slower infinite");
                                                } else if (ret.status == 'backup') {
                                                    $('#{{ task.id }}_mystatus').html("Backup");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-primary animated flash slower infinite");
                                                } else if (ret.status == 'Waiting') {
                                                    $('#{{ task.id }}_mystatus').html("Waiting");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-warning");
                                                } else if (ret.status == 'build') {
                                                    $('#{{ task.id }}_mystatus').html("building");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-primary animated flash slower infinite");
                                                } else if (ret.status == 'SLAMdone') {
                                                    $('#{{ task.id }}_mystatus').html("Done");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-success");
                                                } else if (ret.status == 'backupdone') {
                                                    $('#{{ task.id }}_mystatus').html("Done");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-success");
                                                } else if (ret.status == 'buildfailed') {
                                                    $('#{{ task.id }}_mystatus').html("Failed");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-danger");
                                                } else if (ret.status == 'SLAMfailed') {
                                                    $('#{{ task.id }}_mystatus').html("Failed");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-danger");
                                                } else if (ret.status == 'SSAfailed') {
                                                    $('#{{ task.id }}_mystatus').html("Failed");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-danger");
                                                } else {
                                                    $('#{{ task.id }}_mystatus').html("error");
                                                    $('#{{ task.id }}_mystatus').removeClass().addClass("label label-danger");
                                                }
                                            })
                                        }

                                        {#setInterval(get_status, 1000);#}
                                        var interval = setInterval(function () {
                                            $.getJSON('/test/{{ task.id }}/status', function (ret) {
                                                if (ret.status == 'SLAMdone' && ret.mode == 'SLAM') {
                                                    clearInterval(interval);
                                                }
                                                if (ret.status == 'done' && ret.mode == 'SSA') {
                                                    clearInterval(interval);
                                                }
                                            });
                                            get_status()
                                        }, 1000)
                                    })
                                </script>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-6"><span class="panel-note"><i class="fa fa-clock-o"></i> Last 5 tasks of yours</span></div>
                        <div class="col-md-6 text-right"><a href="/allmytasks" class="btn btn-primary">View All Your Tasks</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
